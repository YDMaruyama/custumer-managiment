"use strict";(()=>{var e={};e.id=755,e.ids=[755],e.modules={30517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},39491:e=>{e.exports=require("assert")},14300:e=>{e.exports=require("buffer")},32081:e=>{e.exports=require("child_process")},6113:e=>{e.exports=require("crypto")},82361:e=>{e.exports=require("events")},57147:e=>{e.exports=require("fs")},13685:e=>{e.exports=require("http")},85158:e=>{e.exports=require("http2")},95687:e=>{e.exports=require("https")},41808:e=>{e.exports=require("net")},22037:e=>{e.exports=require("os")},71017:e=>{e.exports=require("path")},77282:e=>{e.exports=require("process")},85477:e=>{e.exports=require("punycode")},63477:e=>{e.exports=require("querystring")},12781:e=>{e.exports=require("stream")},24404:e=>{e.exports=require("tls")},76224:e=>{e.exports=require("tty")},57310:e=>{e.exports=require("url")},73837:e=>{e.exports=require("util")},59796:e=>{e.exports=require("zlib")},32328:(e,t,r)=>{r.r(t),r.d(t,{headerHooks:()=>h,originalPathname:()=>m,requestAsyncStorage:()=>d,routeModule:()=>p,serverHooks:()=>E,staticGenerationAsyncStorage:()=>c,staticGenerationBailout:()=>S});var s={};r.r(s),r.d(s,{DELETE:()=>DELETE,GET:()=>GET,POST:()=>POST,PUT:()=>PUT,runtime:()=>l});var a=r(10884),o=r(16132),i=r(95798),n=r(21710);async function getSheetsService(){let e=process.env.GOOGLE_PROJECT_ID,t=process.env.GOOGLE_CLIENT_EMAIL,r=process.env.GOOGLE_PRIVATE_KEY;if(!e||!t||!r)throw Error("Google Sheets API credentials are not fully configured");r=r.replace(/\\n/g,"\n");let s=new n.lkr.auth.GoogleAuth({credentials:{client_email:t,private_key:r},projectId:e,scopes:["https://www.googleapis.com/auth/spreadsheets"]}),a=await s.getClient();return n.lkr.sheets({version:"v4",auth:a})}async function getAllCustomers(e){let t=await getSheetsService(),r=process.env.SHEETS_SPREADSHEET_ID;if(!r)throw Error("SHEETS_SPREADSHEET_ID is not set");let s=await t.spreadsheets.values.get({spreadsheetId:r,range:`${e}!A1:Z`}),a=s.data.values||[];if(a.length<1)return[];let o=a[0].map(e=>e.trim()),i=[];for(let e=1;e<a.length;e++){let t=a[e],r={};if(o.forEach((e,s)=>{r[e]=t[s]}),void 0!==r.visitCount){let e=Number(r.visitCount);r.visitCount=isNaN(e)?void 0:e}i.push(r)}return i}async function appendCustomer(e,t){let r=await getSheetsService(),s=process.env.SHEETS_SPREADSHEET_ID;if(!s)throw Error("SHEETS_SPREADSHEET_ID is not set");let a=await getAllCustomers(e),o=Object.keys(a[0]||t),i=o.map(e=>{let r=t[e];return void 0===r?"":String(r)});await r.spreadsheets.values.append({spreadsheetId:s,range:`${e}!A1`,valueInputOption:"USER_ENTERED",requestBody:{values:[i]}})}async function updateCustomer(e,t,r){let s=await getSheetsService(),a=process.env.SHEETS_SPREADSHEET_ID;if(!a)throw Error("SHEETS_SPREADSHEET_ID is not set");let o=await getAllCustomers(e),i=o.findIndex(e=>e.id===t);if(-1===i)throw Error(`No customer with id ${t}`);let n=o[i],u={...n,...r},l=Object.keys(u),p=l.map(e=>{let t=u[e];return void 0===t?"":String(t)});await s.spreadsheets.values.update({spreadsheetId:a,range:`${e}!A${i+2}`,valueInputOption:"USER_ENTERED",requestBody:{values:[p]}})}async function deleteCustomer(e,t){let r=await getSheetsService(),s=process.env.SHEETS_SPREADSHEET_ID;if(!s)throw Error("SHEETS_SPREADSHEET_ID is not set");let a=await getAllCustomers(e),o=a.findIndex(e=>e.id===t);if(-1===o)throw Error(`No customer with id ${t}`);let i=o+2;await r.spreadsheets.batchUpdate({spreadsheetId:s,requestBody:{requests:[{deleteDimension:{range:{sheetId:await getSheetId(r,s,e),dimension:"ROWS",startIndex:i-1,endIndex:i}}}]}})}async function getSheetId(e,t,r){let s=await e.spreadsheets.get({spreadsheetId:t}),a=s.data.sheets?.find(e=>e.properties?.title===r);if(!a)throw Error(`Sheet ${r} not found`);return a.properties.sheetId}let u=process.env.SHEETS_CUSTOMER_SHEET||"Customers";async function GET(){try{let e=await getAllCustomers(u);return i.Z.json(e)}catch(e){return console.error(e),new i.Z(e.message||"Failed to fetch customers",{status:500})}}async function POST(e){try{let t=await e.json(),r=t.id||crypto.randomUUID(),s={id:r,name:t.name,kana:t.kana,phone:t.phone,email:t.email,birthDate:t.birthDate,gender:t.gender,address:t.address,firstVisitDate:t.firstVisitDate,lastVisitDate:t.lastVisitDate,visitCount:t.visitCount?Number(t.visitCount):void 0,tags:t.tags,allergy:t.allergy,history:t.history,consent:t.consent,note:t.note};return await appendCustomer(u,s),i.Z.json(s,{status:201})}catch(e){return console.error(e),new i.Z(e.message||"Failed to create customer",{status:500})}}async function PUT(e){try{let t=await e.json(),r=t.id;if(!r)return new i.Z("id is required",{status:400});let s={...t};return delete s.id,await updateCustomer(u,r,s),i.Z.json({message:"updated"})}catch(e){return console.error(e),new i.Z(e.message||"Failed to update customer",{status:500})}}async function DELETE(e){try{let{searchParams:t}=new URL(e.url),r=t.get("id");if(!r)return new i.Z("id is required",{status:400});return await deleteCustomer(u,r),i.Z.json({message:"deleted"})}catch(e){return console.error(e),new i.Z(e.message||"Failed to delete customer",{status:500})}}let l="nodejs",p=new a.AppRouteRouteModule({definition:{kind:o.x.APP_ROUTE,page:"/api/route",pathname:"/api",filename:"route",bundlePath:"app/api/route"},resolvedPagePath:"/Users/maruyamayuudai/Downloads/customer-management-app/app/api/route.ts",nextConfigOutput:"",userland:s}),{requestAsyncStorage:d,staticGenerationAsyncStorage:c,serverHooks:E,headerHooks:h,staticGenerationBailout:S}=p,m="/api/route"}};var t=require("../../webpack-runtime.js");t.C(e);var __webpack_exec__=e=>t(t.s=e),r=t.X(0,[480],()=>__webpack_exec__(32328));module.exports=r})();